---
layout: default
title: ELB
parent: Networking and Content Delivery
nav_order: 2
has_children: true 
has_toc: false
---

# ELB
Amazon Elastic Load Balancing
- Distribute network traffic to improve application scalability

## Load Balancers
- Servers that forward traffic to multiple servers downstream
- But expose only a single point of access to your application

## AWS Load Balancer Types
- [CLB - Classic Load Balancer](./clb/)
- [ALB - Application Load Balancer](./alb)
- [NLB - Network Load Balancer](./nlb)
- [GLB - Gateway Load Balancer](./glb)

## Health Checks
- enables load balancer to know if target instances are available to reply to request
- endpoint must respond with 200 response to tag target as healthy
- Specify the ff:
  - Target: Protocol / Port / Path
  - Timeout
  - Interval
  - Unhealthy Threshold (# of consecutive failed response to tag instance as unhealthy)
  - Healthy Threshold (# of consecutive success response to tag instance as healthy )
- Listeners?

## ELB Info Dump
- ELB uses a DNS record TTL of 60 seconds 
- By default the ELB has an idle connection timeout of 60 seconds

### Sticky Sessions (Session Affinity)
- implementation so that same client is always redirected to same instance behind the load balancer
- can be enabled for Classic Load Balancer and Application Load Balancer
- Implementation:
    - Application-based cookies:
        - Custom Cookie
            - generated by the target, can include any custom attribute
            - reserved cookie names: AWSALB, AWSALBAPP, AWSALBTG
        -  Application Cookie
            - generated by the load balancer
            - AWSALBAPP
    - Duration-based cookies
        - Generated by the load balancer
        - AWSALB for ALB
        - AWSELB for CLB
        - Duration can be between 1 second to 7 days.
- Configured on the target group attributes for ALB

### Cross-zone Load Balancing
- configuration of LB to distribute traffic evenly across **all** registered instances in all AZ
- e.g. scenario:    
    - ELB is configured to work on AZ1 and AZ2
        - note that physically, there are 2 ELB instances, one on each AZ
        - from the client perspectice, will only connect to 1 ELB endpoint
    - AZ1 has 2 running instances
    - AZ2 has 8 running instances
    - When clients accesses the ELB, 50% will be routed to ELB on AZ1, 50% will be routed to ELB on AZ2
        - but each ELB will distribute evenly to instances across both AZs.
        - each instance will be balanced to receive 10% of incoming traffic
- vs if Cross-zone load balancing is not enabled
    - 50% of traffic will be routed on AZ1
        - out of this, will be distributed to 2 instances on AZ1 (25% of traffic for instances on AZ1)
    - 50% of traffic will be routed on AZ2
        - out of this, will be distributed to 8 instances on AZ2 (6.25% of traffic for instances on AZ2) 
- To take note when there is imbalance on number of instances on AZ
- Always ON for ALB. No charges for inter-AZ traffic
- Configurable for NLB, disabled by default. Extra charges for inter-AZ traffic
- Configurable for CLB, disabled by default. No charges for inter-AZ traffic

### SSL and TLS Certificates
- SSL Certificate allows traffic to be encrypted in transit (in-flight encryption) between client and ELB
- HTTPS connection from client to ELB. SSL termination on ELB
- can manage certificates on ACM (AWS Certificate Manager)
- Server Name Indication
    - solves the problem of loading multiple SSL Certificates on a single web server
    - Server Name Indication (SNI) allows you to expose multiple HTTPS applications each with its own SSL certificate on the same listener.
    - _newer_ protocol where client indicates hostname of target server on initial SSL handshake
    - using this info, server will return correct certificate, or return a default
    - Only works for ALB or NLB (v2). Not applicable to Classic Load Balancer
        - Will require 1 CLB for each hostname

### Connection Draining
- Connection Draining for CLB
- Deregistration Delay for ALB and NLB
- Setting to configure time to complete "in-flight requests" while instance is unhealthy or de-registering
- default is 300 seconds, can configure between 1 to 3600
- or disable (set to 0 )